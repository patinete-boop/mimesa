<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Prueba Login Spotify</title>
</head>
<body>
  <h1>Prueba de login con Spotify</h1>
  <button id="loginBtn">Login con Spotify</button>
  <pre id="output"></pre>

  <script>
    const CLIENT_ID = "f0bf147de2084f78b676c0fb89482fee";
    const REDIRECT_URI = "https://patinete-boop.github.io/mimesa/callback";

    const SCOPES = [
      "streaming",
      "user-read-email",
      "user-read-private",
      "user-read-playback-state",
      "user-modify-playback-state",
      "playlist-read-private"
    ].join(" ");

    function getAuthURL() {
      const auth = new URL("https://accounts.spotify.com/authorize");
      auth.searchParams.set("client_id", CLIENT_ID);
      auth.searchParams.set("response_type", "token");
      auth.searchParams.set("redirect_uri", REDIRECT_URI);
      auth.searchParams.set("scope", SCOPES);
      auth.searchParams.set("show_dialog", "true");
      return auth.toString();
    }

    document.getElementById("loginBtn").addEventListener("click", () => {
      window.location.href = getAuthURL();
    });

    // Al volver del login
    window.addEventListener("load", () => {
      const hash = window.location.hash.substring(1);
      if (hash) {
        const params = new URLSearchParams(hash);
        const token = params.get("access_token");
        const scopes = params.get("scope");
        document.getElementById("output").textContent =
          "Token recibido:\n" + token + "\n\nScopes:\n" + scopes;
      } else {
        const savedHash = localStorage.getItem("spotify_hash");
        if (savedHash) {
          const params = new URLSearchParams(savedHash.substring(1));
          const token = params.get("access_token");
          const scopes = params.get("scope");
          document.getElementById("output").textContent =
            "Token desde localStorage:\n" + token + "\n\nScopes:\n" + scopes;
        }
      }
    });
  </script>
</body>
</html>
